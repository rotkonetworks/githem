server {
    listen 80;
    server_name get.githem.com;
    root /usr/share/nginx/html;
    
    # Default endpoint - smart routing based on user agent
    location = / {
        # For curl/wget/powershell - serve install script
        if ($http_user_agent ~* "(curl|wget|powershell|invoke-webrequest)") {
            add_header Content-Type "text/plain; charset=utf-8";
            rewrite ^ /install.sh last;
        }
        
        # For browsers - serve landing page
        try_files /index.html =404;
    }
    
    # Shell script variants
    location ~ ^/(install|install\.sh)$ {
        add_header Content-Type "text/plain; charset=utf-8";
        try_files /install.sh =404;
    }
    
    # PowerShell script
    location = /install.ps1 {
        add_header Content-Type "text/plain; charset=utf-8";
        try_files /install.ps1 =404;
    }
    
    # CSS file for landing page
    location = /style.css {
        add_header Content-Type "text/css; charset=utf-8";
        try_files /style.css =404;
    }
    
    # Security headers
    add_header X-Content-Type-Options nosniff always;
    add_header X-Frame-Options DENY always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Different cache policies for different content types
    location ~* \.(css|js)$ {
        add_header Cache-Control "public, max-age=3600" always;
    }
    
    location ~* \.(sh|ps1)$ {
        add_header Cache-Control "no-cache, no-store, must-revalidate" always;
    }
    
    location = /index.html {
        add_header Cache-Control "public, max-age=300" always;
    }
    
    # CORS for cross-origin requests
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Content-Type" always;
    
    # Handle preflight requests
    if ($request_method = 'OPTIONS') {
        return 204;
    }
}
